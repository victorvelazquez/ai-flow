# Release Workflow

Automate version publishing following semantic versioning, syncing package.json, git tags, and npm registry.

**Display Behavior:** Show step title (`## Step N/5: Name`) in your response BEFORE executing commands in that step.

---

## üìã Step 1/5: Determine Version

Read current version from `package.json` and determine next version using semver:

### Semver Rules

| Type      | Pattern   | Use Case                         | Example           |
| --------- | --------- | -------------------------------- | ----------------- |
| **Patch** | `X.Y.Z+1` | Bug fixes, minor improvements    | `1.0.5` ‚Üí `1.0.6` |
| **Minor** | `X.Y+1.0` | New backward-compatible features | `1.0.6` ‚Üí `1.1.0` |
| **Major** | `X+1.0.0` | Breaking changes                 | `1.1.0` ‚Üí `2.0.0` |

**Decision criteria:**

- Breaking API changes ‚Üí Major
- New features, no breaking changes ‚Üí Minor
- Bug fixes, docs, refactors ‚Üí Patch

---

## ‚úèÔ∏è Step 2/5: Update Version References

Update version string in all relevant files:

### Files to Modify

**package.json**

```json
{
  "version": "X.X.X"
}
```

**src/cli.ts** (3 locations)

```typescript
// 1. ASCII banner
const banner = `AI Flow v${version}`;

// 2. Config object
const config = { version: "X.X.X" };

// 3. Commander version
program.version("X.X.X");
```

**templates/AGENT.template.md** (if version referenced)

```markdown
Generated by ai-flow vX.X.X
```

---

## ‚úÖ Step 3/5: Commit and Tag

Stage modified files, create version commit, tag, and push.

### Commands (User must click Allow)

```bash
git add package.json src/cli.ts templates/AGENT.template.md
git commit -m "chore: bump version to X.X.X"
git tag vX.X.X
git push origin main --tags
```

**Tag format:** `vX.X.X` (lowercase 'v' prefix)

**Commit message:** Must follow pattern `chore: bump version to X.X.X`

---

## üì¶ Step 4/5: Publish to npm

Publish package to npm registry.

```bash
npm publish --access public
```

**Prerequisites:**

- User authenticated via `npm login`
- Package name `ai-flow` available
- No existing version X.X.X in registry

**If publish fails:**

- Check npm authentication: `npm whoami`
- Verify version doesn't exist: `npm view ai-flow versions`

---

## ‚úÖ Step 5/5: Verify

Confirm successful release across platforms:

### Verification Checklist

- [ ] **npm registry:** Version visible at [npmjs.com/package/ai-flow](https://npmjs.com/package/ai-flow)
- [ ] **GitHub tags:** Tag `vX.X.X` present in [repository tags](https://github.com/victorvelazquez/ai-flow/tags)
- [ ] **GitHub releases:** Release notes published (optional)
- [ ] **Installation test:** `npm install -g ai-flow@X.X.X` works

### Success Output

```
## Release vX.X.X Complete

‚úÖ Version updated in all files
‚úÖ Commit created: abc1234
‚úÖ Tag created: vX.X.X
‚úÖ Pushed to GitHub
‚úÖ Published to npm
‚úÖ Verified on npmjs.com

üéâ Release successful!
```

---

## Execution Model

| Step | Commands          | User Interaction    |
| ---- | ----------------- | ------------------- |
| 1    | Determine version | Automatic           |
| 2    | Update files      | Automatic (editing) |
| 3    | Commit, tag, push | Click Allow         |
| 4    | npm publish       | Click Allow         |
| 5    | Verify            | Automatic           |

## Constraints

**Prohibited:**

- Publishing without testing
- Skipping version updates in any file
- Using non-standard tag format
- Publishing with uncommitted changes

**Required:**

- Semver compliance
- All version references updated
- Clean working directory
- Conventional commit message format

**Estimated Time:** 3-5 minutes

---

**Reference:** [Semantic Versioning 2.0.0](https://semver.org/)  
**Last Updated:** 2025-11-27
